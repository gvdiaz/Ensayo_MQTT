# Objetivo: Desarrollar un simulador de datos que reporte su contenido a un servidor MQTT designado.
# Autor: Gustavo V. Diaz
# Fecha: 15/11/2025

** Descripción de actividades **

1. Comencé por consultar a deepseek si me recomendaba una estructura de trabajo para cumplir los siguientes requisitos,
```
I would like to develop a script in python 3.10 that:
1. Read from a mqtt public broker meteorological variables like tempeture and relative humidity
2. Connect the client who subscribe to the meteorological variables to three clients from the mqtt broker in cedalo platform.
3. Be able to name the channels in the cedalo broker.
```
Me recomendó la siguiente estructura,

```
meteo_mqtt_bridge/
├── main.py
├── config.py
├── requirements.txt
└── README.md
```
Dicha estructura la voy a guardar en la carpeta de "proposal/meteo_mqtt_bridge/"

2. Para implementar dicha estructura le consulté por un contenedor en python que pudiera llevar adelante esta tarea. Como no me satisfiso su respuesta busqué buenas implementaciones de contenedores livianos solo con python. Encontré el siguiente script,

```python
FROM python:3 as builder
RUN pip install pipenv
COPY Pipfile* /
WORKDIR /
RUN mkdir /.venv  # The presence of a .venv folder triggers pipenv to use it by default
RUN pipenv install --deploy

FROM python:3-slim
COPY --from=builder /.venv /.venv
ENV PATH=/.venv/bin:$PATH  # Activate virtualenv!
WORKDIR /myapp
COPY src .
CMD ["python3", "app.py"]
```
Fuente: [link stackoverflow](https://stackoverflow.com/questions/58300046/how-to-make-lightweight-docker-image-for-python-app-with-pipenv)

*Nota*
Esta compilación de contenedor tiene dos instancias, la primera como compilador utiliza alguna imagen e instala todo lo que necesita a partir del comando `RUN pipenv install --deploy`. Y luego utiliza esos datos compilados sobre una versión slim de una imagen de python y copia lo compilado anteriormente. Por lo cual reduce el espacio de almacenamiento en 5 o 6 veces.

Lo que me permitió aprender sobre la herramienta pipenv. La cual es similar a pip pero lo que me permite es crear sobre una carpeta un entorno virtual mucho más fácil que virtual env. Corriendo el comando `pipenv install` sobre un directorio crea un entorno virtual con dos archivos,

```
meteo_mqtt_bridge/
├── Pipfile              # ← You create this
├── Pipfile.lock         # ← Generated automatically by pipenv
├── .env                 # ← Your environment variables
├── main.py
├── config.py
└── README.md
```

Respecto de los archivo originales aparecen los archivos Pipfile y Pipfile.lock los cuales no tienen solamente el package mas tal vez la versión. Este tipo de gestor de paquetes permite tener una mejor trazabilidad de los paquetes python utilizados en el proyecto.

**Recomendación de deepseek**

```
Key Benefits of Using Pipenv:

    Deterministic builds - Lock file ensures exact versions

    Security - Hash verification for all packages

    Virtual environment management - Automatic isolation

    Dev/prod separation - Different dependencies for each

    Scripts - Easy command shortcuts

The actual Pipfile.lock with proper hash values will be generated when you run pipenv install - this ensures reproducible builds across different systems!
```

Pero para poder aplicar este tipo de gestor en el contenedor debí actualizar pipenv y luego poder generar mi propio entorno en el host para poder crear Pipenv y Pipenv.lock. Posteriormente en el host instalar los paquetes requeridos en el proyecto y finalmente copiar dichos "Pipenv"s en el contenedor como lo indica el código docker que copia los Pipenv como `COPY Pipfile* /`

**Conclusión**

Intentaré dar compilación al contendor para poner en funcionamiento este simulador a partir de lo recomendado por deepseek (en cuanto a código) y por [N1ngu](https://stackoverflow.com/users/11715259/n1ngu) en el link [python builder](https://stackoverflow.com/users/11715259/n1ngu)